!function(){var t={nzc:{1:"预展中",2:"进行中",3:"定制中",4:"发货中",5:"结束"},yy:{1:"预展中",2:"进行中",3:"落款中",4:"烧窑中",5:"发货中",6:"结束"},nzct:{1:"距开始时间",2:"距结束时间",3:"开始制作时间",4:"距发货结束",5:"结束时间"},yyt:{1:"距开始时间",2:"距结束时间",3:"烧窑时间",4:"发货时间",5:"距发货结束",6:"结束时间"}},i={nzc:1,yy:2,myzc:3},e=function(t,i){return"nzc"==i?[3,5].indexOf(t)!=-1:[3,4,6].indexOf(t)!=-1},s=function(){return'<a v-for="(item, index) in list" :href="getURL(item)">\t\t\t\t<div class="imgBox">\t\t\t\t\t<div v-if="inject.style!=\'big\' || item.data.referVideo!=\'video\'" :class="[isEndState(item)?\'endAt\':\'\']" class="img" v-on:click="gotoLive($event, item)" v-lazy:background-image.container="getImgURL(item.pic)"></div>\t\t\t\t\t<iframe v-if="inject.style==\'big\' && item.data.referVideo==\'video\'&& item.data.vRef" frameborder="0" width="100%" height="220px" :src="item.data.vRef+\'&adplay=0\'" allowfullscreen="true" ></iframe>\t\t\t\t\t<ul class="row">\t\t\t\t\t\t<li v-if="!isEndState(item)" :class="[\'state\'+item.state, inject.style==\'big\'?\'col-xs-3\':\'col-xs-12\']" class="status"><span>{{getStatus(item.state)}}</span></li>\t\t\t\t\t\t<li :class="[getTitleClass(item)]" class="title l1eps">{{item.title}}</li>\t\t\t\t\t\t<li v-if="item.state<2" :class="[item.isRemind?\'reminded burlywood\':\'\']" class="col-xs-3 btn btn-default" v-on:click="doRemind($event, item)"><span class="icon"></span>{{item.isRemind?\'已提醒\':\'提醒我\'}}</li>\t\t\t\t\t\t<li v-if="inject.style==\'big\'" class="col-xs-9 l1eps craft">匠人: <img class="img-circle rbPct" v-on:click="gotoProfile(craft)" v-for="craft in item.crafts" :src="getAvatar(craft)"/></li>\t\t\t\t\t</ul>\t\t\t\t\t<div v-if="item.data.referVideo==\'live\'&&!isEndState(item)" class="videoIcon"></div>\t\t\t\t</div>\t\t\t\t<div :class="[(inject.style!=\'big\'&&index+1 == list.length)?\'last\':\'\']" class="box rbb">\t\t\t\t\t<div v-if="inject.style==\'big\'" class="desc l2eps">{{item.desc}}</div>\t\t\t\t\t\t<div class="hpImg col-xs-3" v-if="inject.style==\'big\' && inject.ctg==\'hp\'">\t\t\t\t\t\t\t<div v-if="item.hpCover" class="cover" :style="{height:100>item.percent?100-item.percent:0 +\'%\'}">\t\t\t\t\t\t\t\t<img class="img-circle gray" :src="getHpImg(item)" />\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<img class="img-circle" v-if="item.hpCover" :src="getHpImg(item)" />\t\t\t\t\t\t</div>\t\t\t\t\t\t<div :class="[inject.style==\'big\' && inject.ctg==\'hp\'?\'col-xs-9\':\'\']" class="progress">\t\t\t\t\t\t\t<div class="hpTitle" v-if="inject.ctg==\'hp\'">\t\t\t\t\t\t\t\t<li>濒危</li> <li>复活</li>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div :style="{width: (item.percent>100?\'100\':item.percent) + \'%\'}" class="percent">\t\t\t\t\t\t\t\t<span :class="[item.percent>50?\'right\':\'\']">{{inject.ctg==\'hp\'&& item.percent>100?100:item.percent}}%</span>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div :style="{width:(100>item.percent?100-item.percent:0) + \'%\'}" class="cover"></div>\t\t\t\t\t\t\t<div class="hpTip" v-if="inject.style==\'big\' && inject.ctg==\'hp\'">为濒危手艺加血，助他复活</div>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="row info">\t\t\t\t\t\t\t<div class="col-xs-4">{{item.state>=2?\'支持人数\':\'关注人数\'}}<div class="l1eps">{{item.supportNum}} 人</div></div>\t\t\t\t\t\t\t<div class="col-xs-4">{{inject.tpl==\'nzc\'?\'已筹金额\':\'已押金额\'}}  <div class="l1eps">{{item.totalPrice}}元</div>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="col-xs-4"> {{getTimeData(item)}} <div class="l1eps">{{getTimeData(item, true)}}</div></div>\t\t\t\t\t</div>\t\t\t\t</div><hr v-if="inject.style==\'big\'|| (index+1) != list.length"/>\t\t\t</a><div v-if="isLoading" class="loading"><span class="icon"></span></div>'},a=function(t){var i=t.data.cuid.replace(/ /g,"").replace(/\uff0c/g,",");i=i.split(",");var e={uids:i,iids:[]};for(var s in t.data.itemList)e.iids.push(t.data.itemList[s].iid);return e},n=function(t,i){SyApp.msg.ajax({type:"POST",url:"/v2/activity/itemsAndCrafts",data:{ids:JSON.stringify(t)},dataType:"json",done:function(e,s){if(e&&0===s.code){for(var a in t){var n=[];for(var c in t[a].uids)if(s.res[a])for(var r in s.res[a].craftsmans)if(s.res[a].craftsmans[r].uid==t[a].uids[c]){n.push(s.res[a].craftsmans[r]);break}s.res[a].craftsmans=n}for(var l in s.res){var d=0,o=0,p=0,m=i.list.length-s.res.length+parseInt(l);i.list[m].crafts=s.res[l].craftsmans||[],i.list[m].hpCover=!0;for(var c in s.res[l].items){if(i.list[m].data.itemList&&i.list[m].data.itemList[0]){s.res[l].items[c].iid==i.list[m].data.itemList[0].iid&&(i.list[m].hpCover=s.res[l].items[c].cover);for(var a in i.list[m].data.itemList)if(s.res[l].items[c].iid==i.list[m].data.itemList[a].iid){p+=Number(s.res[l].items[c].price)*(i.list[m].data.itemList[a].stock-s.res[l].items[c].stock);break}}d+=i.list[m].data.itemList[c].stock,o+=s.res[l].items[c].stock}i.list[m].totalPrice=p>1?parseInt(p):p.toFixed(2),i.list[m].state<2?i.list[m].supportNum=i.list[m].followNum:i.list[m].supportNum=d>o?d-o:0,i.list[m].data&&i.list[m].data.saleTarget>0&&(i.list[m].percent=i.list[m].data.saleTarget==p?100:parseInt(p/i.list[m].data.saleTarget*100))}}}})},c=function(t){var e={};t.inject.content.isSingle?(e.url=t.inject.content.url+"?atid="+SyApp.crowdCpt.atid,e.data={type:i[t.tpl]}):(e.url=t.inject.content.url,e.data={type:i[t.tpl],page:t.page}),SyApp.msg.djAjax({type:"POST",url:e.url,data:e.data,dataType:"json",done:function(i,s){if(i&&0===s.code){var c=[];if(!s.res||s.res instanceof Array||(s.res=[s.res],t.isLastPage=!0),s.res&&s.res.length>0){for(var r in s.res)try{s.res[r].data=JSON.parse(s.res[r].data),s.res[r].crafts=[],s.res[r].hpCover=null,s.res[r].supportNum=0,s.res[r].percent=0,s.res[r].totalPrice=0,t.list.push(s.res[r]),c.push(a(s.res[r]))}catch(l){console.log(l)}n(c,t)}else s.res&&(t.isLastPage=!0);t.inject.dispatch&&1==t.page&&t.$root.$emit("CptMsgCrowd",{cmd:"init",data:s.res}),t.ascroll&&t.ascroll.resetload(!0),t.page++}t.isLoading=!1,e=null}})},r={methods:{getTitleClass:function(t){return"big"==this.inject.style?t.state<2?"col-xs-6":"col-xs-9":t.state<2?"col-xs-9":"col-xs-12"},gotoLive:function(t,i){if("big"==this.inject.style){if("live"==i.data.referVideo&&i.id)return SyApp.util.gotoPageBind(19,i.data.vRef);t.stopPropagation(),t.preventDefault()}},gotoProfile:function(t){SyApp.util.gotoPageBind(2,t.uid)},doRemind:function(t,i){return t.stopPropagation(),t.preventDefault(),SyApp.isInDjApp?void($(t.target).hasClass("reminded")||$(t.target).hasClass("icon")||SyApp.msg.djAjax({type:"POST",url:"/v2/activity/notify",data:{atid:i.id},el:t.target,dataType:"json",done:function(e,s){if(e&&0===s.code)i.isRemind=!0,$(t.target).addClass("reminded burlywood"),i.state<2&&i.supportNum++;else{if(s&&s.code===-206)return void window.location.reload();SyApp.ui.toast("设置提醒失败，请先登录或者绑定手机号码")}}},!0,!0)):void(window.location.href=SyApp.APP_DOWNLOAD_URL)},loadMore:function(){this.isLastPage||this.isLoading||(this.isLoading=!0,c(this))}},data:function(){var i=this;return{initload:!0,isLastPage:!1,page:1,isLoading:!1,list:[],tpl:i.inject.tpl?i.inject.tpl:"nzc",isEndState:function(t){return 5==t.state&&"nzc"==this.tpl||6==t.state&&"yy"==this.tpl},getHpImg:function(t){return SyApp.FILE_SERVER+(t.data.itemList[0].pic||t.hpCover)+"_200x200"},getImgURL:function(t){return SyApp.util.getImgUrl(SyApp.FILE_SERVER+t,"l")},getAvatar:function(t){return SyApp.util.getCraftAvatar(t.avatar,"_60x60")},getURL:function(t){if(!i.inject.content.isSingle){var e="nzc"==this.tpl?"crowd":"yayao",s="hp"==i.inject.ctg?"myzc/":"",a=SyApp.util.getFormatUrl(SyApp.H5_HOST+"h5-"+e+"Detail/"+s+t.id,t.title,t.desc,t.pic);return SyApp.util.openH5Url(7,a)}},getTimeData:function(i,s){var a=0==i.state?1:i.state;if(s){var n=e(i.state,this.tpl);return("yy"==this.tpl&&i.state>0&&i.state<6||"nzc"==this.tpl&&!n)&&a++,i.data.tm[a]=10==String(i.data.tm[a]).length?1e3*i.data.tm[a]:i.data.tm[a],SyApp.util.getFormatTime(i.data.tm[a],SyApp.getSysTime(),n)}return t[this.tpl+"t"][String(a)]},getStatus:function(i){return i=0==i?1:i,t[this.tpl][i]},style:{paddingTop:i.inject.top,paddingBottom:i.inject.down,background:i.inject.bg}}},mounted:function(){SyApp.crowdCpt={atid:this.inject.atid||SyApp.util.getPathParam()},this.inject.content.isSingle?this.loadMore():this.$options.vue=this}},l=Vue.extend({components:{"single-crowd":{props:["inject"],methods:r.methods,data:r.data,mounted:r.mounted,template:'<div :id="inject.id" :class="[inject.ctg?inject.ctg:\'default\', inject.style?\'big\':\'small\']" class="syCpt crowdCpt" :style="style">'+s()+"</div>"},"crowd-list":{props:["inject"],methods:r.methods,data:r.data,mounted:r.mounted,template:'<div :id="inject.id" :class="[inject.ctg?inject.ctg:\'default\', inject.style?\'big\':\'small\']" class="syCpt crowdCpt" :style="style" v-infinite-scroll="loadMore" infinite-scroll-disabled="loading" infinite-scroll-distance="10" infinite-scroll-immediate-check="initload">'+s()+"</div>"}},props:{inject:{type:Object}},data:function(){var t=this;return{currentView:t.inject.content.isSingle?"single-crowd":"crowd-list"}},template:'<component :inject="inject" :is="currentView"></component>'});Vue.component("crowdCpt",l)}();